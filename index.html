<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Coach del Equipo de Estrellas - VOICE CONTROL EDITION</title>
    <style>
        :root {
            --neon-blue: #00d2ff;
            --neon-green: #39ff14;
            --neon-red: #ff3131;
            --neon-yellow: #fefe33;
            --bg-dark: #050510;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-dark);
            color: white;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Pantallas */
        .screen {
            display: none;
            width: 100%; height: 100%;
            position: absolute;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .screen.active { display: flex; }

        .panel {
            background: rgba(20, 20, 40, 0.95);
            border: 4px solid var(--neon-blue);
            border-radius: 30px;
            padding: 40px;
            max-width: 800px;
            text-align: center;
            box-shadow: 0 0 50px rgba(0, 210, 255, 0.4);
            position: relative;
        }

        /* HUD Superior */
        .hud {
            position: absolute;
            top: 15px;
            width: 95%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .hud-group { display: flex; gap: 10px; }

        .hud-card {
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid var(--neon-blue);
            font-weight: bold;
            font-size: 1.2rem;
            min-width: 120px;
            text-align: center;
        }

        .score-glow {
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green);
        }

        /* Botones de Control */
        .control-btn-top {
            background: #333;
            color: white;
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.3s;
        }

        .control-btn-top:hover { background: var(--neon-blue); color: black; }

        /* Arena de Juego */
        .arena {
            display: flex;
            gap: 20px;
            width: 100%;
            justify-content: center;
            margin-top: 20px;
        }

        .gamer-station {
            width: 280px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            border: 3px solid transparent;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .gamer-station.warning {
            animation: danger-pulse 0.5s infinite alternate;
            border-color: var(--neon-red);
        }

        @keyframes danger-pulse {
            from { background: rgba(255, 49, 49, 0.1); }
            to { background: rgba(255, 49, 49, 0.3); }
        }

        .monitor {
            background: #000;
            height: 150px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 4rem;
            border: 4px solid #333;
        }

        .alert-bubble {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neon-red);
            width: 70px; height: 70px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            border: 4px solid white;
            box-shadow: 0 0 15px var(--neon-red);
            animation: bounce 0.4s infinite alternate;
            z-index: 50;
        }

        /* Barras de Stats */
        .stats { margin-top: 15px; }
        .label-name { font-weight: bold; color: var(--neon-blue); }

        .bar-container {
            background: #222;
            height: 15px;
            border-radius: 10px;
            margin: 8px 0;
            border: 1px solid #444;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            width: 100%;
            background: var(--neon-green);
            transition: width 0.1s linear;
        }

        .hearts { font-size: 1.2rem; }

        /* Tableta de Comandos */
        .tablet {
            position: absolute;
            bottom: 20px;
            background: #222;
            padding: 15px;
            border-radius: 25px;
            display: flex;
            gap: 15px;
            border: 4px solid #444;
        }

        .tool-btn {
            background: #fff;
            color: #111;
            width: 85px; height: 85px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: 4px solid transparent;
            transition: 0.2s;
        }

        .tool-btn.selected {
            background: var(--neon-green);
            transform: translateY(-15px);
            border-color: white;
            box-shadow: 0 5px 15px rgba(57, 255, 20, 0.5);
        }

        .tool-btn span:first-child { font-size: 2rem; }
        .tool-btn span:last-child { font-size: 0.6rem; font-weight: bold; }

        /* Mensajes de Poder */
        .power-msg {
            position: fixed;
            pointer-events: none;
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--neon-yellow);
            text-shadow: 2px 2px 5px black;
            animation: float-up 0.8s forwards;
            z-index: 200;
        }

        @keyframes float-up {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-80px); }
        }

        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }

        .btn {
            background: var(--neon-blue);
            color: black; padding: 12px 30px;
            border-radius: 50px; border: none;
            font-weight: bold; cursor: pointer; font-size: 1rem;
        }

        .hidden { display: none !important; }

        /* Estilo Bot√≥n Voz Tutorial */
        .voice-toggle-tut {
            position: absolute;
            top: 20px;
            right: 20px;
        }

    </style>
</head>
<body>

    <!-- 1. PANTALLA TUTORIAL -->
    <div id="screen-tutorial" class="screen active">
        <div class="panel">
            <div class="voice-toggle-tut">
                <button class="control-btn-top" onclick="toggleVoice()" id="voice-btn-tut">üîä</button>
            </div>
            <h1 id="tut-title">Preparando Equipo...</h1>
            <div id="tut-visual" style="font-size: 5rem; margin: 20px;">üéÆ</div>
            <p id="tut-text" style="font-size: 1.3rem; min-height: 80px;"></p>
            <div style="display: flex; justify-content: space-between; margin-top: 30px; width: 100%;">
                <button class="btn" style="background: #555; color: white;" onclick="skipTut()">SALTAR</button>
                <button class="btn" id="tut-btn" onclick="nextTut()">SIGUIENTE</button>
            </div>
        </div>
    </div>

    <!-- 2. PANTALLA JUEGO -->
    <div id="screen-game" class="screen">
        <div class="hud">
            <div class="hud-group">
                <div class="hud-card">‚è∞ <span id="game-clock">90</span>s</div>
                <div class="hud-card">PUNTOS: <span id="game-score" class="score-glow">0</span></div>
            </div>
            <div class="hud-group">
                <button class="control-btn-top" onclick="showHelp()">?</button>
                <button class="control-btn-top" onclick="toggleVoice()" id="voice-btn-game">üîä</button>
            </div>
            <div class="hud-card">VIVOS: <span id="team-alive">3</span>/3</div>
        </div>

        <div class="arena">
            <!-- Gamers -->
            <div class="gamer-station" id="station-0" onclick="intervene(0)">
                <div id="alert-0" class="alert-bubble hidden">üßò</div>
                <div class="monitor">üë®‚ÄçüöÄ</div>
                <div class="stats">
                    <span class="label-name">ALEX</span>
                    <div class="bar-container"><div id="bar-0" class="bar-fill"></div></div>
                    <div class="hearts" id="hearts-0">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                </div>
            </div>
            <div class="gamer-station" id="station-1" onclick="intervene(1)">
                <div id="alert-1" class="alert-bubble hidden">üëÄ</div>
                <div class="monitor">üë©‚ÄçüöÄ</div>
                <div class="stats">
                    <span class="label-name">LUNA</span>
                    <div class="bar-container"><div id="bar-1" class="bar-fill"></div></div>
                    <div class="hearts" id="hearts-1">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                </div>
            </div>
            <div class="gamer-station" id="station-2" onclick="intervene(2)">
                <div id="alert-2" class="alert-bubble hidden">üï∫</div>
                <div class="monitor">üê±‚Äçüë§</div>
                <div class="stats">
                    <span class="label-name">MAX</span>
                    <div class="bar-container"><div id="bar-2" class="bar-fill"></div></div>
                    <div class="hearts" id="hearts-2">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                </div>
            </div>
        </div>

        <div class="tablet">
            <div class="tool-btn" id="tool-postura" onclick="selectTool('postura')">
                <span>üßò</span><span>POSTURA</span>
            </div>
            <div class="tool-btn" id="tool-distancia" onclick="selectTool('distancia')">
                <span>üëÄ</span><span>DISTANCIA</span>
            </div>
            <div class="tool-btn" id="tool-pausa" onclick="selectTool('pausa')">
                <span>üï∫</span><span>PAUSA</span>
            </div>
            <div class="tool-btn" id="tool-descanso" onclick="selectTool('descanso')">
                <span>‚è∏Ô∏è</span><span>DESCANSO</span>
            </div>
        </div>
    </div>

    <!-- 3. PANTALLA RESULTADOS -->
    <div id="screen-results" class="screen">
        <div class="panel">
            <h1 id="res-title">FIN DE LA PARTIDA</h1>
            <div id="res-icon" style="font-size: 6rem;">üèÜ</div>
            <h2 id="res-score-final" class="score-glow">PUNTOS: 0</h2>
            <p id="res-msg" style="font-size: 1.2rem; margin: 20px 0;"></p>
            <button class="btn" onclick="location.reload()">REINTENTAR</button>
        </div>
    </div>

    <script>
        // --- CONFIGURACI√ìN ---
        const tutorialSteps = [
            { title: "¬°Bienvenido Coach!", visual: "üéÆ", text: "Soy tu asistente. Tu equipo est√° en la gran final y necesitan que cuides su salud para ganar." },
            { title: "¬°Regla 1: Postura!", visual: "üßò", text: "Si un jugador se encorva (üßò), usa POSTURA. ¬°La espalda recta evita el dolor y mejora el juego!" },
            { title: "¬°Regla 2: Vista!", visual: "üëÄ", text: "Si se pegan a la pantalla (üëÄ), dales DISTANCIA. ¬°Protege sus ojos para que no fallen ning√∫n detalle!" },
            { title: "¬°Regla 3: Movimiento!", visual: "üï∫", text: "Si el cuerpo se duerme, p√≠deles una PAUSA (üï∫). ¬°Estirarse es un power-up para los m√∫sculos!" },
            { title: "¬°Regla 4: Mente!", visual: "‚è∏Ô∏è", text: "Si el cerebro se cansa, dales DESCANSO (‚è∏Ô∏è). ¬°Un segundo de relax evita errores tontos!" },
            { title: "¬°Listos para Ganar!", visual: "üöÄ", text: "Toca la herramienta abajo y luego al jugador con la alerta. ¬°Si su rendimiento llega a cero, perder√°n una vida!" }
        ];

        const interventions = {
            postura: { icon: "üßò", msg: "¬°POSTURA DE PODER!", voice: "¬°Espalda recta, poder que se conecta!" },
            distancia: { icon: "üëÄ", msg: "¬°DISTANCIA INTELIGENTE!", voice: "¬°Ojos de √°guila, mente despierta!" },
            pausa: { icon: "üï∫", msg: "¬°PAUSA M√ÅGICA!", voice: "¬°Cuerpo en movimiento, energ√≠a al cien por ciento!" },
            descanso: { icon: "‚è∏Ô∏è", msg: "¬°MENTE RECARGADA!", voice: "¬°Descanso mental, misi√≥n lograda!" }
        };

        // --- ESTADO ---
        let state = {
            active: false,
            time: 90,
            score: 0,
            tutIdx: 0,
            tool: null,
            voiceEnabled: true,
            gamers: [
                { id: 0, hearts: 3, perf: 100, alert: null },
                { id: 1, hearts: 3, perf: 100, alert: null },
                { id: 2, hearts: 3, perf: 100, alert: null }
            ]
        };

        // --- MANEJO DE VOZ ---
        function speak(text) {
            window.speechSynthesis.cancel();
            if (!state.voiceEnabled) return;
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'es-ES'; u.rate = 1.1;
            window.speechSynthesis.speak(u);
        }

        function toggleVoice() {
            state.voiceEnabled = !state.voiceEnabled;
            const icon = state.voiceEnabled ? "üîä" : "                    üîá";
            document.getElementById('voice-btn-tut').innerText = icon;
            document.getElementById('voice-btn-game').innerText = icon;
            if (!state.voiceEnabled) window.speechSynthesis.cancel();
        }

        // --- TUTORIAL ---
        function renderTut() {
            const s = tutorialSteps[state.tutIdx];
            document.getElementById('tut-title').innerText = s.title;
            document.getElementById('tut-visual').innerText = s.visual;
            document.getElementById('tut-text').innerText = s.text;
            if(state.tutIdx === 5) document.getElementById('tut-btn').innerText = "¬°A LA FINAL!";
            speak(s.text);
        }

        function nextTut() {
            if(state.tutIdx < 5) { state.tutIdx++; renderTut(); }
            else startGame();
        }

        function skipTut() { startGame(); }

        // --- MOTOR DEL JUEGO ---
        function startGame() {
            document.getElementById('screen-tutorial').classList.remove('active');
            document.getElementById('screen-game').classList.add('active');
            state.active = true;
            
            // Reloj y dificultad
            setInterval(() => {
                if(!state.active) return;
                state.time--;
                document.getElementById('game-clock').innerText = state.time;
                if(state.time <= 0) endGame();

                let chance = state.time > 60 ? 0.3 : (state.time > 30 ? 0.5 : 0.7);
                if(Math.random() < chance) spawnAlert();
            }, 1000);

            // Rendimiento en tiempo real
            setInterval(() => {
                if(!state.active) return;
                state.gamers.forEach(g => {
                    if(g.hearts <= 0) return;
                    if(g.alert) {
                        g.perf -= 1.8; // Cae r√°pido con alerta
                        document.getElementById(`station-${g.id}`).classList.add('warning');
                    } else {
                        g.perf -= 0.2; // Cae lento por juego
                        document.getElementById(`station-${g.id}`).classList.remove('warning');
                    }

                    if(g.perf <= 0) {
                        g.hearts--;
                        g.perf = 50;
                        updateUI(g.id);
                        speak("¬°Cuidado entrenador, un jugador est√° fallando!");
                    }
                    updateUI(g.id);
                });
            }, 100);
        }

        function spawnAlert() {
            const avail = state.gamers.filter(g => g.hearts > 0 && !g.alert);
            if(avail.length === 0) return;
            const g = avail[Math.floor(Math.random() * avail.length)];
            const types = Object.keys(interventions);
            g.alert = types[Math.floor(Math.random() * types.length)];
            const b = document.getElementById(`alert-${g.id}`);
            b.innerText = interventions[g.alert].icon;
            b.classList.remove('hidden');
        }

        function selectTool(t) {
            state.tool = t;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById(`tool-${t}`).classList.add('selected');
        }

        function intervene(id) {
            if(!state.active || !state.tool) return;
            const g = state.gamers[id];
            if(g.hearts <= 0) return;

            if(g.alert === state.tool) {
                // √âxito: M√°s puntos si la barra de rendimiento est√° alta
                const bonus = Math.floor(g.perf / 2);
                state.score += 150 + bonus;
                document.getElementById('game-score').innerText = state.score;
                
                showPowerMsg(interventions[g.alert].msg, id);
                speak(interventions[g.alert].voice);
                
                g.perf = Math.min(100, g.perf + 40);
                g.alert = null;
                document.getElementById(`alert-${id}`).classList.add('hidden');
                
                // Limpiar selecci√≥n para obligar a nueva t√°ctica
                state.tool = null;
                document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('selected'));
            } else {
                g.perf = Math.max(0, g.perf - 15);
                speak("¬°Esa no es la soluci√≥n, Coach!");
            }
            updateUI(id);
        }

        function updateUI(id) {
            const g = state.gamers[id];
            const bar = document.getElementById(`bar-${id}`);
            bar.style.width = g.perf + "%";
            
            if(g.perf < 30) bar.style.background = "var(--neon-red)";
            else if(g.perf < 60) bar.style.background = "var(--neon-yellow)";
            else bar.style.background = "var(--neon-green)";

            let hStr = "";
            for(let i=0; i<3; i++) hStr += i < g.hearts ? "‚ù§Ô∏è" : "üñ§";
            document.getElementById(`hearts-${id}`).innerText = hStr;

            if(g.hearts <= 0) {
                const station = document.getElementById(`station-${id}`);
                station.style.opacity = "0.3";
                station.style.pointerEvents = "none";
                const alive = state.gamers.filter(g => g.hearts > 0).length;
                document.getElementById('team-alive').innerText = alive;
                if(alive === 0) endGame();
            }
        }

        function showPowerMsg(t, id) {
            const station = document.getElementById(`station-${id}`);
            const rect = station.getBoundingClientRect();
            const msg = document.createElement('div');
            msg.className = 'power-msg';
            msg.innerText = t;
            msg.style.left = rect.left + "px";
            msg.style.top = rect.top + (rect.height / 2) + "px";
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 800);
        }

        function showHelp() {
            state.active = false;
            window.speechSynthesis.cancel();
            speak("Coach, recuerda: Espalda recta para Postura. Distancia para los ojos. Pausa para estirar el cuerpo. Y descanso para la mente.");
            alert("TABLA DE ESTRATEGIA:\nüßò POSTURA: Espalda recta.\nüëÄ DISTANCIA: Alejarse de la pantalla.\nüï∫ PAUSA: Estiramientos.\n‚è∏Ô∏è DESCANSO: Mirar a otro lado.");
            state.active = true;
        }

        function endGame() {
            state.active = false;
            document.getElementById('screen-game').classList.remove('active');
            document.getElementById('screen-results').classList.add('active');
            const alive = state.gamers.filter(g => g.hearts > 0).length;
            document.getElementById('res-score-final').innerText = "PUNTOS: " + state.score;
            
            if(alive === 3) {
                document.getElementById('res-msg').innerText = "¬°VICTORIA PERFECTA! Tu equipo gan√≥ la final en excelente estado f√≠sico. ¬°Eres el mejor Coach!";
                speak("¬°Victoria perfecta, entrenador! El equipo est√° orgulloso de ti.");
            } else if (alive > 0) {
                document.getElementById('res-msg').innerText = "¬°GANAMOS LA FINAL! Lograste mantener al equipo en pie bajo presi√≥n. ¬°Buen trabajo!";
                speak("¬°Ganamos! Buen trabajo cuidando a los chicos.");
            } else {
                document.getElementById('res-icon').innerText = "ü§ï";
                document.getElementById('res-msg').innerText = "El equipo colaps√≥. Recuerda que sin salud no hay victoria. ¬°Aprendamos de esto para la pr√≥xima!";
                speak("Perdimos esta vez. Debemos cuidar mejor la salud del equipo.");
            }
        }

        window.onload = renderTut;
    </script>
</body>
</html>
